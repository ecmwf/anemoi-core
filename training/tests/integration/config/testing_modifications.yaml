# Modifications for testing training cycles
dataloader:
  num_workers:
    training: 2
    validation: 2
  batch_size:
    training: 2
    validation: 2
  limit_batches:
    training: 2
    validation: 2

diagnostics:
  log:
    wandb:
      enabled: False
      entity: null # override '???'
    mlflow:
      _target_: pytorch_lightning.loggers.wandb.WandbLogger
      enabled: False
      tracking_uri: null # override '???'
  #! adding section here to overwrite plotting settings - deactivate PlotSpectrum callback until fix for
  plot:
    asynchronous: False # Whether to plot asynchronously
    callbacks:
      # Add plot callbacks here
      - _target_: anemoi.training.diagnostics.callbacks.plot.GraphTrainableFeaturesPlot
        every_n_epochs: 5
        dataset_names: ${diagnostics.plot.datasets_to_plot} #TODO can make ["data"] a default in pydantic and remove here
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotLoss
        # group parameters by categories when visualizing contributions to the loss
        # one-parameter groups are possible to highlight individual parameters
        dataset_names: ${diagnostics.plot.datasets_to_plot} #TODO can make this a default in pydantic and remove here
        parameter_groups:
          moisture: [tp, cp, tcw]
          sfc_wind: [10u, 10v]
        every_n_batches: ${diagnostics.plot.frequency.batch}
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotSample
        dataset_names: ${diagnostics.plot.datasets_to_plot} #TODO can make this a default in pydantic and remove here
        sample_idx: ${diagnostics.plot.sample_idx}
        per_sample : 6
        parameters: ${diagnostics.plot.parameters}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        #Defining the accumulation levels for precipitation related fields and the colormap
        accumulation_levels_plot: [0, 0.05, 0.1, 0.25, 0.5, 1, 1.5, 2, 3, 4, 5, 6, 7, 100] # in mm
        precip_and_related_fields: ${diagnostics.plot.precip_and_related_fields}
        colormaps: ${diagnostics.plot.colormaps}
      #! DEACTIVATING UNTIL PYSHTOOLS FIX FOR 3.13
      # - _target_: anemoi.training.diagnostics.callbacks.plot.PlotSpectrum
      #   dataset_names: ${diagnostics.plot.datasets_to_plot} #TODO can make this a default in pydantic and remove here
      #   # every_n_batches: 100 # Override for batch frequency
      #   # min_delta: 0.01 # Minimum distance between two consecutive points
      #   sample_idx: ${diagnostics.plot.sample_idx}
      #   every_n_batches: ${diagnostics.plot.frequency.batch}
      #   parameters:
      #   - z_500
      #   - tp
      #   - 2t
      #   - 10u
      #  - 10v
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotHistogram
        dataset_names: ${diagnostics.plot.datasets_to_plot} #TODO can make this a default in pydantic and remove here
        sample_idx: ${diagnostics.plot.sample_idx}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        precip_and_related_fields: ${diagnostics.plot.precip_and_related_fields}
        parameters:
        - z_500
        - tp
        - 2t
        - 10u
        - 10v



system:
  hardware:
    accelerator: auto
    num_gpus_per_node: 1
    num_nodes: 1
    num_gpus_per_model: 1

  output:
    # We overwrite this in the test to use pytest tmp_path but need a value for hydra
    root: ${oc.env:PWD}/tmp_output/

  input:
    graph: null
    truncation: null
    truncation_inv: null

graph:
  overwrite: True

model:
  num_channels: 16

training:
  max_epochs: 2

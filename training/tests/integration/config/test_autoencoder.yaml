# Modifications for the basic template "config.yaml"
system:
  input:
    dataset: anemoi-integration-tests/training/datasets/aifs-ea-an-oper-0001-mars-o96-2017-2017-6h-v8-testing.zarr

dataloader:
  training:
    datasets:
      data:
        end: 2017-01-08 12:00:00
  validation:
    datasets:
      data:
        start: 2017-01-08 18:00:00

focus_areas:
  europe:
    latlon_bbox: [30.0, -20.0, 60.0, 40.0]


diagnostics:
  log:
    mlflow:
      authentication: True
      experiment_name: 'ci_hpc_mlflow'
  # autoencoder so far do not hanlde most of the plotting callbcaks
  plot:
    asynchronous: False # Whether to plot asynchronously
    callbacks:
      # Add plot callbacks here
      - _target_: anemoi.training.diagnostics.callbacks.plot.GraphTrainableFeaturesPlot
        every_n_epochs: 5
        dataset_names: ["data"]
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotLoss
        # group parameters by categories when visualizing contributions to the loss
        # one-parameter groups are possible to highlight individual parameters
        dataset_names: ["data"]
        parameter_groups:
          moisture: [tp, cp]
        every_n_batches: ${diagnostics.plot.frequency.batch}
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotSample
        dataset_names: ["data"]
        sample_idx: ${diagnostics.plot.sample_idx}
        per_sample : 6
        parameters: ${diagnostics.plot.parameters}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        focus_area: ${diagnostics.plot.focus_areas.europe}
        output_steps: ${training.multistep_output}
        #Defining the accumulation levels for precipitation related fields and the colormap
        accumulation_levels_plot: [0, 0.05, 0.1, 0.25, 0.5, 1, 1.5, 2, 3, 4, 5, 6, 7, 100] # in mm
        precip_and_related_fields: ${diagnostics.plot.precip_and_related_fields}
        colormaps: ${diagnostics.plot.colormaps}
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotSpectrum
        dataset_names: ["data"]
        # every_n_batches: 100 # Override for batch frequency
        # min_delta: 0.01 # Minimum distance between two consecutive points
        sample_idx: ${diagnostics.plot.sample_idx}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        output_steps: ${training.multistep_output}
        parameters:
        - z_500
        - tp
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotHistogram
        dataset_names: ["data"]
        sample_idx: ${diagnostics.plot.sample_idx}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        output_steps: ${training.multistep_output}
        precip_and_related_fields: ${diagnostics.plot.precip_and_related_fields}
        parameters:
        - z_500
        - tp

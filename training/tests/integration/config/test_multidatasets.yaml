# Modifications for the multi dataset template "multi.yaml"
system:
  input:
    dataset: anemoi-integration-tests/training/datasets/aifs-ea-an-oper-0001-mars-o96-2017-2017-6h-v8-testing.zarr
    dataset_b: anemoi-integration-tests/training/datasets/cerra-rr-an-oper-0001-mars-5p5km-2017-2017-6h-v3-testing.zarr

dataloader:
  training:
    datasets:
      era5:
        end: 2017-01-08 12:00:00
      cerra:
        end: 2017-01-08 12:00:00
  validation:
    datasets:
      era5:
        start: 2017-01-08 18:00:00
      cerra:
        start: 2017-01-08 18:00:00

data:
  datasets:
    cerra:
      forcing:
      - "cos_latitude"
      - "cos_longitude"
      - "sin_latitude"
      - "sin_longitude"
      - "cos_julian_day"
      - "cos_local_time"
      - "sin_julian_day"
      - "sin_local_time"
      diagnostic:
      - "tp"

      processors:
        normalizer:
          config:
            default: "mean-std"
            std:
            - "tp"
            min-max:
            max:
            none:
            - "cos_latitude"
            - "cos_longitude"
            - "sin_latitude"
            - "sin_longitude"
            - "cos_julian_day"
            - "cos_local_time"
            - "sin_julian_day"
            - "sin_local_time"

diagnostics:
  plot:
    parameters: ["tp"]
    datasets_to_plot: ["era5", "cerra"] # Default dataset names to use in the plot callbacks
    callbacks:
      - _target_: anemoi.training.diagnostics.callbacks.plot.GraphTrainableFeaturesPlot
        dataset_names: ${diagnostics.plot.datasets_to_plot}
        every_n_epochs: 5
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotLoss
        dataset_names: ${diagnostics.plot.datasets_to_plot}
        parameter_groups:
          moisture: []
        every_n_batches: ${diagnostics.plot.frequency.batch}
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotSample
        dataset_names: ${diagnostics.plot.datasets_to_plot}
        sample_idx: ${diagnostics.plot.sample_idx}
        per_sample : 6
        parameters: ${diagnostics.plot.parameters}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        accumulation_levels_plot: [0, 0.05, 0.1, 0.25, 0.5, 1, 1.5, 2, 3, 4, 5, 6, 7, 100] # in mm
        precip_and_related_fields: []
        colormaps: ${diagnostics.plot.colormaps}
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotSpectrum
        dataset_names: ${diagnostics.plot.datasets_to_plot}
        sample_idx: ${diagnostics.plot.sample_idx}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        parameters: ${diagnostics.plot.parameters}
      - _target_: anemoi.training.diagnostics.callbacks.plot.PlotHistogram
        dataset_names: ${diagnostics.plot.datasets_to_plot}
        sample_idx: ${diagnostics.plot.sample_idx}
        every_n_batches: ${diagnostics.plot.frequency.batch}
        precip_and_related_fields: []
        parameters: ${diagnostics.plot.parameters}

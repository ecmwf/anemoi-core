prefetch_factor: 2
pin_memory: True

# ============
# read_group_size:
#   Form subgroups of model comm groups that read data together.
#   Each reader in the group only reads 1/read_group_size of the data
#   which is then all-gathered between the group.
#   This can reduce CPU memory usage as well as increase dataloader throughput.
#   The number of GPUs per model must be divisible by read_group_size.
#   To disable, set to 1.
# ============
read_group_size: ${system.hardware.num_gpus_per_model}

num_workers:
  training: 1
  validation: 1
  test: 1
batch_size:
  training: 2
  validation: 2
  test: 2

# ============
# Multi-dataset batch composition:
# Each batch will contain a dictionary with samples from all datasets:
# {"dataset_a": tensor_batch_a, "dataset_b": tensor_batch_b, ...}
# All datasets must have the same number of valid samples for synchronization
# ============

# runs only N training batches [N = integer | null]
# if null then we run through all the batches
limit_batches:
  training: null
  validation: null
  test: 20

# ============
# Multi-Dataset Configuration
# Define multiple datasets that will be synchronized during training
# Each dataset must have the same number of valid time samples
# ============

training:
  datasets:
    era5:
      dataset: ${system.input.dataset}
      start: 1985
      end: 2020
      frequency: ${data.frequency}
      drop: []
      trajectory: null
      lam_mask_radius_km: null
    cerra:
      dataset: ${system.input.dataset_b}  # Using same dataset as duplicate for testing
      start: 1985
      end: 2020
      frequency: ${data.frequency}
      drop: []
      trajectory: null
      lam_mask_radius_km: null

validation_rollout: 1 # number of rollouts to use for validation

# Multi-dataset validation with same datasets, different time period
validation:
  datasets:
    era5:
      dataset: ${system.input.dataset}
      start: 2021
      end: 2021
      frequency: ${data.frequency}
      drop: []
      trajectory: null
      lam_mask_radius_km: null
    cerra:
      dataset: ${system.input.dataset_b}
      start: 2021
      end: 2021
      frequency: ${data.frequency}
      drop: []
      trajectory: null
      lam_mask_radius_km: null

# Multi-dataset test with same datasets, different time period
test:
  datasets:
    era5:
      dataset: ${system.input.dataset}
      start: 2022
      end: null
      frequency: ${data.frequency}
      drop: []
      trajectory: null
      lam_mask_radius_km: null
    cerra:
      dataset: ${system.input.dataset_b}
      start: 2022
      end: null
      frequency: ${data.frequency}
      drop: []
      trajectory: null
      lam_mask_radius_km: null

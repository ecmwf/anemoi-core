# Multi-dataset data configuration for debugging with era5 and era5_copy
format: zarr
# Time frequency requested from dataset
frequency: 6h
# Time step of model (must be multiple of frequency)
timestep: 6h

# Default data configuration (inherited by all datasets)
default:
  # Features that are not part of the forecast state
  # but are used as forcing to generate the forecast state
  forcing:
  - "cos_latitude"
  - "cos_longitude"
  - "sin_latitude"
  - "sin_longitude"
  - "cos_julian_day"
  - "cos_local_time"
  - "sin_julian_day"
  - "sin_local_time"
  - "insolation"
  - "lsm"
  - "sdor"
  - "slor"
  - "z"

  # Features that are only part of the forecast state
  # but are not used as the input to the model
  diagnostic:
  - tp
  - cp

  normalizer:
    default: "mean-std"

    # Standardization applied to tp and cp variables
    std:
    - "tp"

    min-max:
    max:
    - "sdor"
    - "slor"
    - "z"
    none:
    - "cos_latitude"
    - "cos_longitude"
    - "sin_latitude"
    - "sin_longitude"
    - "cos_julian_day"
    - "cos_local_time"
    - "sin_julian_day"
    - "sin_local_time"
    - "insolation"
    - "lsm"

  # Processors including imputers and normalizers are applied in order of definition
  processors:
    normalizer:
      _target_: anemoi.models.preprocessing.normalizer.InputNormalizer
      config: ${data.default.normalizer}

# Dataset-specific configurations
datasets:
  era5:
    # ERA5 inherits from default configuration
    # Could override specific settings here if needed
    forcing: ${data.default.forcing}
    diagnostic: ${data.default.diagnostic}
    normalizer: ${data.default.normalizer}
    processors: ${data.default.processors}

  era5_copy:
    # ERA5_copy uses same configuration as ERA5 for debugging
    forcing: ${data.default.forcing}
    diagnostic: ${data.default.diagnostic}
    normalizer: ${data.default.normalizer}
    processors: ${data.default.processors}

# Values set in the code
num_features: null # number of features in the forecast state

data_handler:
  training:
      start: 1979-01-01
      end: 2021
  validation:
      start: 2022
      end: 2023-12-31

  search_path: ${hardware.paths.data}

  sources:

    - dataset: aifs-ea-an-oper-0001-mars-o96-1979-2023-6h-v8
      data_group: era5_o96
      extra:
        # can also use an omegaconf reference with
        # normalisation: ${data.default.normalizer}
        normalisation:
          default: "mean-std"
          std:
          - "tp"
          min-max:
          max:
          - "sdor"
          - "slor"
          - "z"
          none:
          - "cos_latitude"
          - "cos_longitude"
          - "sin_latitude"
          - "sin_longitude"
          - "cos_julian_day"
          - "cos_local_time"
          - "sin_julian_day"
          - "sin_local_time"
          - "insolation"
          - "lsm"
        graph:
          {default: 'mean-std', 'mean-std': [tp, 2t]}
        other_config_specific_to_the_dataset: {todo: 42}

    - dataset: aifs-ea-an-oper-0001-mars-o48-1979-2022-6h-v6
      data_group: era5_o48
      extra:
        normalisation: ${data.default.normalizer}
        graph: {todo: 42}
        other_config_specific_to_the_dataset: {todo: 42}

    # unused in this example: era5 n320 resolution
    - dataset: aifs-ea-an-oper-0001-mars-n320-1979-2023-6h-v8
      data_group: era5_highres
      extra:
        normalisation: ${data.default.normalizer}
        graph: {todo: 42}

    # unused in this example
    - dataset: cerra-rr-an-oper-0001-mars-5p0-2017-2017-6h-v1
      data_group: cerra
      extra:
        normalisation: ${data.default.normalizer}
        graph: {todo: 42}

    # unused in this example
    - dataset: observations-dataset-1
      data_group: iasi

    # unused in this example
    - dataset: observations-dataset-1
      data_group: metar

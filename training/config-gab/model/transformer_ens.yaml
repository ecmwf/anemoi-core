activation: GELU
num_channels: 1024


model:
  _target_: aifs.model.gnn.AnemoiEnsModelEncProcDec

noise_injector:
  _target_: aifs.layers.ensemble.NoiseInjector
  _convert_: all
  noise_channels_dim: 4
  noise_mlp_hidden_dim: 32
  inject_noise: True

processor:
  _target_: anemoi.models.layers.processor.TransformerProcessor
  _convert_: all
  activation: ${model.activation}
  num_layers: 16
  num_chunks: 2
  mlp_hidden_ratio: 4 # GraphTransformer or Transformer only
  num_heads: 16 # GraphTransformer or Transformer only
  window_size: 512
  dropout_p: 0.0 # GraphTransformer

encoder:
  _target_: anemoi.models.layers.mapper.GraphTransformerForwardMapper
  _convert_: all
  trainable_size: ${model.trainable_parameters.data2hidden}
  sub_graph_edge_attributes: ${model.attributes.edges}
  activation: ${model.activation}
  num_chunks: 1
  mlp_hidden_ratio: 4 # GraphTransformer or Transformer only
  num_heads: 16 # GraphTransformer or Transformer only


decoder:
  _target_: anemoi.models.layers.mapper.GraphTransformerBackwardMapper
  _convert_: all
  trainable_size: ${model.trainable_parameters.hidden2data}
  sub_graph_edge_attributes: ${model.attributes.edges}
  activation: ${model.activation}
  num_chunks: 1
  mlp_hidden_ratio: 4 # GraphTransformer or Transformer only
  num_heads: 16 # GraphTransformer or Transformer only

trainable_parameters:
  data: 8
  hidden: 8
  data2hidden: 8
  hidden2data: 8

# bounding: #These are applied in order
#   - _target_: anemoi.models.layers.bounding.ReluBounding #[0, infinity)
#     variables:
#     - tp
#   - _target_: anemoi.models.layers.bounding.FractionBounding # fraction of tp
#     variables:
#     - cp
#     min_val: 0
#     max_val: 1
#     total_var: tp

logging:
  debug: False

attributes:
  edges:
  - edge_length
  - edge_dirs
  nodes: []

node_loss_weight: area_weight
